### CSMITH REGRESSION TESTING ###
---------------------------------

This project assumes you have csmith present in your $PATH. You can download csmith from https://github.com/csmith-project/csmith.git and find more details here: http://embed.cs.utah.edu/csmith/.

To run the regression simply type make in the current folder.

### Changes to be Made before running ###
-----------------------------------------

In the Makefile line-3 change the variable "CSMITH_INCDIR" to point to the "runtime" folder of csmith. 

You can also change the number testcases to be generated by changing the variable "runs" in line 5.

It also assumes the binary for simulation of RTL (i.e. out) is present in ../bin folder. This out can be generated for either bluesim, iverilog, ncverilog or modelsim. Please refere to Makefile of the previous folder to know more details about generating the RTL binary.

### Steps involved in running a single step of CSMITH regression ###
--------------------------------------------------------------------
There three steps in running CSMITH:

*	First the generated test case (test.c) will be compiled using the gcc of the host pc. Any testcase which exceeds a runtime of 2 mins or fails to compile using the host pc will be discarded. On execution of the binary a checksum is printed.
* 	If the above step passes, the same test case is compiled using riscv32-unknown-elf-gcc. This compilation uses some of the files (such as crt.S, syscalls.c) taken from UCB's riscv-benchmarks folder. The compiler generated binary is then run on spike. The checksum printed is then compared with that of the host-pc. If a mis-match occurs we discard the test case and generate a new.
*	If both the above steps pass, a shakti specific binary (with modifications in syscalls.c) is generated along with the corresponding hex file. This RTL binary (i.e. out) is then executed. This produces a file - app_log which contains the checksum. This checksum is compared against that of spike. A mis-match terminates the regression. This step will time-out is the RTL sim takes more than 2 min to finish. This has been set based on bluesim simulations which are typically pretty fast. While using verilog simulations you might want to increase this number by changing the timeout limit in line-12.

Unlike the SHAKTI AAPG regression tests which compares the register dumps of the spike and RTL after every instruction. This particular regression testing only checks the final checksum improving runtime of the entire regression.

### Tips ###
------------

*	It is advisable to remove all the $display statements from the RTL binary to improve simulation runtime. 
*	One can also use different flags of csmith to generate a variety of different tests. Checkout csmith --help for more information on these flags. 

